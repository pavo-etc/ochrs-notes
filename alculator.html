<!DOCTYPE html>
<html lang='en'>
<head>
<link rel='apple-touch-icon' sizes='180x180' href='/media/icon/apple-touch-icon.png'/>
<link rel='icon' type='image/png' sizes='32x32' href='/media/icon/favicon-32x32.png' />
<link rel='icon' type='image/png' sizes='16x16' href='/media/icon/favicon-16x16.png' />
<link rel='manifest' href='/media/icon/site.webmanifest' />
<link rel='mask-icon' href='/media/icon/safari-pinned-tab.svg' color='#bd93f9' />
<link rel='shortcut icon' href='/media/icon/favicon.ico' />
<meta name='msapplication-TileColor' content='#603cba' />
<meta name='msapplication-config' content='/media/icon/browserconfig.xml' />
<meta name='theme-color' content='#282A36' />
<meta charset='UTF-8'>
<meta name='description' content='An alternate frontend for Dan Murphy's' />
<meta name='author' content='Zach Manson' />
<meta name='viewport' content='width=device-width, initial-scale=1' />
<link rel='stylesheet' type='text/css' href='links/main.css' />
<title>notes: alculator</title>
<meta property='og:title' content='alculator' />
<meta property='og:type' content='website' />
<meta property='og:description' content='An alternate frontend for Dan Murphy's' />
<meta property='og:site_name' content='notes' />
<meta property='og:url' content='https://notes.zachmanson.com//alculator.html' />
</head>
<body>
<nav>
<a href='index.html'><img src='/media/icon/icon.png' alt='notes' height='100' /></a>
<ul>
<li><a href='projects.html' class="active">projects</a></li>
<li><a href='notes.html'>notes</a></li>
<li><a href='archive.html'>archive</a></li>
<li><a href='about.html'>about</a></li>
</ul>
<ul>
<li><a href='snakeware.html'>snakeware</a></li>
<li><a href='covid19_tracker.html'>covid19 tracker</a></li>
<li><a href='alculator.html' class="active">alculator</a></li>
</ul>
<ul>
</ul>
</nav>
<main>
<h1>An alternate frontend for Dan Murphy's</h1>
<a href="https://alculator.zachmanson.com">Alculator</a> was written in the waning days of 2022 to determine the cheapest drinks at Dan Murphy's, per standard drink. The site is build with Next.js and hosted on Vercel.<p>If you click on the title bar there is a hidden interface used for debugging and finding data anomalies.</p>
<h2>Dan's API</h2>
<p>Dan Murphy's website is a bloated Angular project but the public APIs used by the site have little to no security. After some mild poking around I was able to determine the routes needed and the general schema in use. Annoyingly, their APIs seemed designed around serving data that the frontend could display with almost little to no modification, rather than serving data in a logical format.</p>
<p>
</p>
<p>For example, for any given product, the site will send a JSON object.  This will contain 3 different prices for the product for the different pack sizes you can purchase them in.  These are labelled <code>caseprice</code>, <code>singleprice</code>, and <code>inanysixprice</code>. Case price, understably, represents the price of a case.  A case of Gage Roads Pipe Dreams Coastal Lager Bottles may have a caseprice of $31.55, but the only way to know how many bottles are in this case are in a field called <code>caseprice.Message</code>.  This is actually a string, that <b>usually</b> says something like "case (24)", when it should obviously just be an associated int called something like <code>caseprice.units</code>.</p>
<p>
</p>
<p><code>singleprice</code> and <code>inanysixprice</code> are even worse, as they are used semi-interchangably. <code>singleprice</code> tends to represent the price of a single bottle, and <code>inanysixprice</code> tends to represent the price of a single bottle in a pack of 6.  Althought sometimes it's a pack of 4.  Or 8.  When <code>singleprice</code> isn't undefined, <code>singleprice</code> sometimes refers to the price of a pack of 6.  The only way to know for sure is by checking if <code>singleprice?.PackType === "Pack"</code> or <code>singleprice?.PackType === "Bottle"</code>.  And of course, when <code>singleprice</code> does mean a pack, the number of units is <b>usually</b> stored in a string.</p>
<p>This is all in service of avoiding frontend rendering logic as much as possible.  Perhaps this is why their API server is so horrendously slow. It can take minutes to return a list of 500 drinks, and times out easily.  To get all of their products (1000+ beers, 6000+ red wines) in my script I needed to sequentially chain queries in batches of 100 drinks.</p>
<p>The data itself is riddled with mistakes an inconsistencies. "Standard Drinks" is inconsistently used in packs, where usually it represents a single unit and <a href="https://www.danmurphys.com.au/product/808932">occasionally it represents the sum of all the units</a>.  Sometimes fields are just completely wrong (<a href="https://www.danmurphys.com.au/product/194571">White Bay Brewing Alcohol Volume especially bad</a>), or use values for bottles of different sizes (<a href="https://www.danmurphys.com.au/product/907223">350mL bottle with 11 standards</a>). These products are collected in the <a href="https://github.com/pavo-etc/alculator/blob/main/science/blacklist.json"><code>blacklist.json</code></a> file and ignored by the script that downloads the catalogue.</p>
<a href="https://github.com/pavo-etc/alculator/blob/main/science/api.js">The final script</a> is warty and takes about 15 minutes to run, but converts the data to a sane schema.  This script is run daily via GitHub Action, and the new data is directly stored in JSON files and committed to the repo.  This is inefficient, but meant I didn't have to mess around with databases in my deployment.  I do hope to one day set up a proper database for this.</main>
<footer>
<img src='/media/icon/arrow_up.svg' /> <a href='#'>Back to top</a> | last edit: <em>Wed Jan 18 11:09:50 2023
</em>
<hr />
<section>
<p>Made ineffeciently by <a href='https://zachmanson.com'>Zach Manson</a></p>
</section>
</footer>
</body>
</html>
